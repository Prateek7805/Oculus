const char _script[] PROGMEM = R"=====(
const DESKTOP_WIDTH=768,HOST_URL=window.location.origin,SPEED_MAX=255,SPEED_MIN=0,BRIGHT_MAX=255,BRIGHT_MIN=0;var Socket,state={headLight:0,speed:0,brightness:0,navbar:0,jConn:!1},controllerState={keyboardS:!1,joystickS:!1};function d(e){return document.getElementById(e)}function dae(e,t,r){e.addEventListener(t,r)}function dar(e,t,r){e.removeEventListener(t,r)}function dc(e,t){return document.getElementsByClassName(e)[t||0]}function dnone(e){e.style.display="none"}function dflex(e){e.style.display="flex"}const er=e=>{console.log(e)},disEn=(e,t)=>{e.disabled=t},_send=(e,t)=>{Socket.send(e+t)};function copy(e){if(!e)return e;let t,r=Array.isArray(e)?[]:{};for(const a in e)t=e[a],r[a]="object"==typeof t?copy(t):t;return r}const toNum=e=>parseFloat(e.substring(0,e.lastIndexOf("px"))),validateCred=(e,t)=>!!e.match(/^[^!#;+\]\/"\t][^+\]"\t]{0,31}$/)&&!(""==t||!t.match(/^[ -~]{8,63}$/));function animate({timing:e,draw:t,duration:r}){let a=performance.now();requestAnimationFrame(function s(d){let n=(d-a)/r;n>1&&(n=1);let o=e(n);t(o),n<1&&requestAnimationFrame(s)})}const connect=()=>{Socket=new WebSocket("ws://"+window.location.hostname+":81/");var e=d("connection");Socket.onmessage=(e=>{er(e.data)}),Socket.onopen=(()=>{er("Socket connected."),e.innerHTML="Online <div class='dot dot-online'></div>"}),Socket.onclose=(t=>{er("Socket is closed. Reattempting.."),e.innerHTML="Retry <div class='dot dot-reconn'></div>",setTimeout(function(){connect()},250)}),Socket.onerror=(t=>{console.error("Socket encountered error: ",t.message,"Closing socket"),e.innerHTML="Offline <div class='dot dot-offline'></div>",Socket.close()})},navBarSlide=()=>{var e=dc("nav-bar"),t=1==state.navbar?0:1;state.navbar=t,animate({duration:1e3,timing:function(e){return val=1/(1+Math.exp(-(30*e-5)))},draw:function(r){var a=-100*Math.abs(t-r);Math.abs(a)>96?(dnone(e),state.navbar=0,updateAllHeights()):Math.abs(a)<5?(dflex(e),state.navbar=1,updateAllHeights()):(dflex(e),state.navbar=t),e.style.transform=`translateX(${a}%)`}})},closeNavBar=()=>{state.navbar&&navBarSlide()},showGamepad=()=>{var e=dc("settings"),t=dc("gamepad"),r=dc("setup"),a=dc("reset-page");keyEvents(controllerState.keyboardS),joyEvents(controllerState.joystickS),dnone(e),dnone(r),dnone(a),dflex(t)},showSettings=()=>{dc("settings"),dc("gamepad"),dc("setup");dnone(dc("gamepad")),dnone(dc("setup")),keyEvents(!1),dflex(dc("settings"))},showSetup=()=>{keyEvents(!1),dnone(dc("gamepad")),dnone(dc("settings")),dflex(dc("setup"))},showReset=()=>{keyEvents(!1),dnone(dc("gamepad")),dnone(dc("settings")),dflex(dc("reset-page"))};dae(dc("nav-hamburger"),"click",()=>{navBarSlide(),showGamepad()}),dae(dc("gamepad"),"click",()=>{closeNavBar(),showGamepad()}),dae(d("setup"),"click",()=>{closeNavBar(),keyEvents(!1),dnone(dc("gamepad")),dnone(dc("settings")),dflex(dc("setup"))}),dae(d("reset-data"),"click",()=>{closeNavBar(),keyEvents(!1),dnone(dc("gamepad")),dnone(dc("settings")),dflex(dc("reset-page"))}),dae(d("setting"),"click",()=>{closeNavBar(),showSettings()}),dae(d("SUBMIT_STA"),"click",()=>{var e=d("SSID_STA").value,t=d("PASS_STA").value;validateCred(e,t)?fetch(`${HOST_URL}/cred`,{method:"POST",headers:{"Content-type":"application/x-www-form-urlencoded"},body:`type=STA&ssid=${e}&pass=${t}`}).then(e=>e.text()).then(e=>{d("SSID_STA").value="",d("PASS_STA").value=""}):(d("SSID_STA").value="",d("PASS_STA").value="",er("Enter Correct Creds"))}),dae(d("SUBMIT_AP"),"click",()=>{var e=d("SSID_AP").value,t=d("PASS_AP").value;validateCred(e,t)?fetch(`${HOST_URL}/cred`,{method:"POST",headers:{"Content-type":"application/x-www-form-urlencoded"},body:`type=AP&ssid=${e}&pass=${t}`}).then(e=>e.text()).then(e=>{d("SSID_AP").value="",d("PASS_AP").value=""}):(d("SSID_AP").value="",d("PASS_AP").value="",er("Enter Correct Creds"))});const updateState=e=>{state={...state,...e},connect(),headLight(),brightness(),speed()},resetState=()=>{fetch(`${HOST_URL}/resetstate`).then(e=>e.text()).then(()=>{fetch(`${HOST_URL}/state`).then(e=>e.json()).then(e=>updateState(e))})};dae(d("reset-state"),"click",resetState);const resetCreds=()=>{fetch(`${HOST_URL}/resetcreds`).then(e=>e.text())};dae(d("reset-creds"),"click",resetCreds);const resetAll=()=>{resetState(),resetCreds()};dae(d("reset-all"),"click",resetAll);const updateAllHeights=()=>{const e=(e,t)=>{e.style.height=t};var t=getComputedStyle(dc("header")),r=getComputedStyle(dc("container")),a=toNum(r.height)-toNum(t.height)+"px";e(dc("nav-bar"),a),e(dc("gamepad"),a),e(dc("settings"),a),e(dc("setup"),a),e(dc("reset-page"),a)};dae(window,"resize",updateAllHeights);const headlightToggle=()=>{state.headLight=1-state.headLight,headLight(),sendCommand("s","h",state.headLight)},headLight=()=>{var e=d("headLight-icon");1==state.headLight?e.style.display="inline":e.style.display="none"},brightness=()=>{d("brightness").value=state.brightness,state.brightness=parseInt(d("brightness").value);var e=getComputedStyle(document.querySelector(":root")).getPropertyValue("--headLight-glow");d("headLight-icon").style.filter=`drop-shadow(0 0 ${4*state.brightness/100}px ${e})`},changeBrightness=e=>{sendCommand("s","b",e)},speed=()=>{dc("speed").value=state.speed,state.speed=parseInt(dc("speed").value),d("speed-val").innerHTML=state.speed},changeSpeed=e=>{sendCommand("s","s",e)};dae(d("brightness"),"input",e=>{state.brightness=e.target.value,brightness()}),dae(dc("speed"),"input",e=>{state.speed=e.target.value,speed()});const getTheme=()=>localStorage.getItem("theme"),setTheme=e=>{localStorage.setItem("theme",e),document.documentElement.className=e,d("darkmode").innerHTML="darkMode"==e?"Light Mode":"Dark Mode"},toggleTheme=()=>setTheme("darkMode"!=getTheme()?"darkMode":"lightMode");dae(d("darkmode"),"click",toggleTheme),dae(document,"DOMContentLoaded",()=>{updateAllHeights(),dae(dc("forward"),"mousedown",forwardO),dae(dc("backward"),"mousedown",reverseO),dae(dc("left"),"mousedown",leftO),dae(dc("right"),"mousedown",rightO),dae(dc("forward"),"mouseup",forwardF),dae(dc("backward"),"mouseup",reverseF),dae(dc("left"),"mouseup",leftF),dae(dc("right"),"mouseup",rightF),dae(dc("speed"),"keydown",e=>{e.preventDefault()}),dae(dc("forward"),"touchstart",forwardO),dae(dc("backward"),"touchstart",reverseO),dae(dc("left"),"touchstart",leftO),dae(dc("right"),"touchstart",rightO),dae(dc("forward"),"touchend",forwardF),dae(dc("backward"),"touchend",reverseF),dae(dc("left"),"touchend",leftF),dae(dc("right"),"touchend",rightF),dae(dc("stop"),"click",()=>{stop(),fetch(`${HOST_URL}/off`)}),keyInit(),joyInit(),dae(window,"gamepadconnected",()=>{er("gamepad connected"),state.jConn=!0,joyEvents(controllerState.joystickS),createGVector()}),dae(window,"gamepaddisconnected",()=>{state.jConn=!1,joyEvents(controllerState.joystickS),clearProgress()}),fetch(`${HOST_URL}/state`).then(e=>{if(e.ok)return e.json();throw new Error("Please reset status...")}).then(e=>{updateState(e),dae(d("headlight"),"click",headlightToggle),dae(d("brightness"),"change",e=>{changeBrightness(e.target.value)}),dae(dc("speed"),"change",e=>{changeSpeed(e.target.value)}),dae(d("restart"),"click",()=>sendCommand("s","r",0)),dae(d("deepSleep"),"click",()=>sendCommand("s","d",0))}).catch(e=>er(e))});const sendCommand=(e,t,r)=>{_send(e[0]+t,r)},forwardO=()=>sendCommand("c",0,1),reverseO=()=>sendCommand("c",1,1),leftO=()=>sendCommand("c",2,1),rightO=()=>sendCommand("c",3,1),forwardF=()=>sendCommand("c",0,0),reverseF=()=>sendCommand("c",1,0),leftF=()=>sendCommand("c",2,0),rightF=()=>sendCommand("c",3,0),stop=()=>sendCommand("o","s",0),saveTable=(e,t)=>{localStorage.setItem(e,JSON.stringify(t))},getTable=e=>JSON.parse(localStorage.getItem(e)),loadTable=(e,t)=>{let r=copy(e),a=getTable(t);if(a)for(var s=0;s<r.length;s++)r[s].key=a[s].key;else saveTable(t,e);return r},handleController=e=>{let t=e.target.checked;for(var r in controllerState){controllerState[r]=!1;try{d(r).checked=!1}catch(e){}}d(e.target.id).checked=t,controllerState[e.target.id]=t,joyEvents(controllerState.joystickS)},kConDefault=[{type:"forward",command:"forward",key:"ArrowUp",KEYDOWN:forwardO,KEYUP:forwardF},{type:"reverse",command:"reverse",key:"ArrowDown",KEYDOWN:reverseO,KEYUP:reverseF},{type:"right",command:"right",key:"ArrowRight",KEYDOWN:rightO,KEYUP:rightF},{type:"left",command:"left",key:"ArrowLeft",KEYDOWN:leftO,KEYUP:leftF},{type:"stop",command:"Stop",key:"Space",KEYDOWN:stop},{type:"light",command:"Headlight",key:"KeyB",KEYDOWN:()=>{keyBrightness("press")}},{type:"brightnessp",command:"Headlight Brightness +",key:"KeyH",KEYDOWN:()=>{keyBrightness("plus")}},{type:"brightnessm",command:"Headlight Brightness -",key:"KeyN",KEYDOWN:()=>{keyBrightness("minus")}},{type:"speedp",command:"Speed +",key:"NumpadAdd",KEYDOWN:()=>{keySpeed("plus")}},{type:"speedm",command:"Speed -",key:"NumpadSubtract",KEYDOWN:()=>{keySpeed("minus")}}];var kCont;const keySpeed=e=>{switch(e){case"plus":state.speed<255&&(state.speed+=10,speed(),changeSpeed(state.speed));break;case"minus":state.speed>0&&(state.speed-=10,speed(),changeSpeed(state.speed))}},keyBrightness=e=>{switch(e){case"press":headlightToggle();break;case"plus":state.brightness<255&&(state.brightness+=10,brightness(),changeBrightness(state.brightness));break;case"minus":state.brightness>0&&(state.brightness-=10,brightness(),changeBrightness(state.brightness))}},keyControl=e=>{kCont.forEach(t=>{t.key==e.code&&t[e.type.toUpperCase()]()})},getkeyObj=e=>{for(var t,r=0;r<kCont.length;r++)kCont[r].type==e&&(t=kCont[r]);return t},keyEvents=e=>{e?(dae(document,"keydown",keyControl),dae(document,"keyup",keyControl)):(dar(document,"keydown",keyControl),dar(document,"keyup",keyControl))},renderKeys=()=>{const e=d("keyboard-controls");let t='<tr class="table-head"><th>Control</th><th>Key</th></tr>';kCont.forEach(e=>{t+=`<tr class="table-body" id="${e.type}p"><td>${e.command}</td><td id="${e.type}" onclick="editKeyTable(this)">${e.key}</td></tr>`}),e.innerHTML=t},editKeyTable=e=>{e.parentElement.innerHTML=`<td>${getkeyObj(e.id).command}</td><td id="${e.id}"><input type='text' class='table-text' onkeydown="setKey(event, this.parentElement.id)" placeholder="press a key"></td>`,d(e.id).childNodes[0].focus()};function validateKeyPress(e){return e>47&&e<58||32==e||13==e||e>36&&e<41||e>64&&e<91||e>95&&e<112||e>185&&e<193||e>218&&e<223}function keyNotExists(e){let t=!0;return kCont.forEach(r=>{r.key==e&&(t=!1)}),t}const setKey=(e,t)=>{if((e=e||window.event).preventDefault(),validateKeyPress(e.charCode?e.charCode:e.keyCode)&&keyNotExists(e.code)){for(var r=0;r<kCont.length;r++)kCont[r].type==t&&(kCont[r].key=e.code);saveTable("keyControl",kCont),d(t+"p").innerHTML=`<td>${t}</td><td id='${t}' onclick='editKeyTable(this)'>${e.code}</td>`}else renderKeys()},resetKeys=()=>{saveTable("keyControl",kConDefault),kCont=copy(kConDefault),renderKeys()};dae(d("key-reset"),"click",resetKeys);const keyInit=()=>{kCont=loadTable(kConDefault,"keyControl"),renderKeys()},joyDefault=[{type:"forward",command:"Forward/Reverse",key:"a1",sent:{forwardO:!1,reverseO:!1}},{type:"right",command:"Left/Right",key:"a0",sent:{leftO:!1,rightO:!1}},{type:"stop",command:"Stop",key:"b2",KEYDOWN:stop},{type:"light",command:"Headlight",key:"b0",KEYDOWN:()=>{keyBrightness("press")}},{type:"brightnessp",command:"Headlight Brightness +",key:"b5",KEYDOWN:()=>{keyBrightness("plus")}},{type:"brightnessm",command:"Headlight Brightness -",key:"b7",KEYDOWN:()=>{keyBrightness("minus")}},{type:"speedp",command:"Speed +",key:"b4",KEYDOWN:()=>{keySpeed("plus")}},{type:"speedm",command:"Speed -",key:"b6",KEYDOWN:()=>{keySpeed("minus")}}];var joyCon,gVector=[];const getGObj=e=>{for(var t,r=0;r<gVector.length;r++)gVector[r].index==e&&(t=gVector[r]);return t},joyEvents=e=>{e?state.jConn&&update():(cancelAnimationFrame(joyUpdate),clearProgress())},renderJoy=()=>{const e=d("joystick-controls");let t='<tr class="table-head"><th>Control</th><th>Channel</th></tr>';joyCon.forEach(e=>{t+=`<tr class="table-body" id="${e.type}j"><td>${e.command}</td><td id="${e.type}"><div class="progress" id="p${e.key}"><div><div></div></div></td></tr>`}),e.innerHTML=t},clearProgress=()=>{joyCon.forEach(e=>{d(`p${e.key}`).childNodes[0].childNodes[0].style.width="0%"})},clearSent=e=>{for(var t in e)e[t]=!1},joyLogic=()=>{joyCon.forEach(e=>{var t=getGObj(e.key);"flex"==dc("settings").style.display&&(d(`p${e.key}`).childNodes[0].childNodes[0].style.width=`${100*t.curr}%`);try{if("axis"==t.type)switch(e.command){case"Forward/Reverse":t.curr>.7?e.sent.reverseO||(clearSent(e.sent),e.sent.reverseO=!0,reverseO()):t.curr<.3?e.sent.forwardO||(clearSent(e.sent),e.sent.forwardO=!0,forwardO()):e.sent.forwardO?(clearSent(e.sent),forwardF()):e.sent.reverseO&&(clearSent(e.sent),reverseF());break;case"Left/Right":t.curr>.7?e.sent.rightO||(clearSent(e.sent),e.sent.rightO=!0,rightO()):t.curr<.3?e.sent.leftO||(clearSent(e.sent),e.sent.leftO=!0,leftO()):e.sent.leftO?(clearSent(e.sent),leftF()):e.sent.rightO&&(clearSent(e.sent),rightF())}else t.curr-t.prev==1&&e.KEYDOWN()}catch(e){}})};var joyUpdate;const update=()=>{for(const t of navigator.getGamepads()){var e=0;if(t){for(const[r,a]of t.axes.entries())gVector[e].prev=gVector[e].curr,gVector[e].curr=.5*a+.5,e++;for(const[r,a]of t.buttons.entries())gVector[e].prev=gVector[e].curr,gVector[e].curr=a.value,e++;joyCon.forEach(e=>{var t=getGObj(e.key);"flex"==dc("settings").style.display&&(d(`p${e.key}`).childNodes[0].childNodes[0].style.width=`${100*t.curr}%`);try{if("axis"==t.type)switch(e.command){case"Forward/Reverse":t.curr>.7?e.sent.reverseO||(clearSent(e.sent),e.sent.reverseO=!0,reverseO()):t.curr<.3?e.sent.forwardO||(clearSent(e.sent),e.sent.forwardO=!0,forwardO()):e.sent.forwardO?(clearSent(e.sent),forwardF()):e.sent.reverseO&&(clearSent(e.sent),reverseF());break;case"Left/Right":t.curr>.7?e.sent.rightO||(clearSent(e.sent),e.sent.rightO=!0,rightO()):t.curr<.3?e.sent.leftO||(clearSent(e.sent),e.sent.leftO=!0,leftO()):e.sent.leftO?(clearSent(e.sent),leftF()):e.sent.rightO&&(clearSent(e.sent),rightF())}else t.curr-t.prev==1&&e.KEYDOWN()}catch(e){}});break}}joyUpdate=requestAnimationFrame(update)},createGVector=()=>{gVector=[];for(const r of navigator.getGamepads())if(r){for(const[t,a]of r.axes.entries()){var e={type:"axis",index:`a${t}`,prev:a,curr:a};gVector.push(e)}for(const[e,a]of r.buttons.entries()){var t={type:"button",index:`b${e}`,prev:a.value,curr:a.value};gVector.push(t)}break}},joyInit=()=>{joyCon=loadTable(joyDefault,"joyControl"),renderJoy()};toggleTheme(),toggleTheme();
)=====";