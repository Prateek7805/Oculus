const char _script[] PROGMEM = R"=====(
const DESKTOP_WIDTH=768,HOST_URL=window.location.origin,SPEED_MAX=255,SPEED_MIN=0,BRIGHT_MAX=255,BRIGHT_MIN=0,EYEOPEN='<svg {{e}} viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="eye"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>',EYECLOSE='<svg {{e}} viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="eye"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg>';var Socket,state={headLight:0,speed:0,brightness:0,navbar:0,jConn:!1},controllerState={keyboardS:!1,joystickS:!1};function d(e){return document.getElementById(e)}function dae(e,t,n){e.addEventListener(t,n)}function dar(e,t,n){e.removeEventListener(t,n)}function dc(e,t){return document.getElementsByClassName(e)[t||0]}function dca(e){return document.getElementsByClassName(e)}function dnone(e){e.style.display="none"}function dflex(e){e.style.display="flex"}const er=e=>{console.log(e)},disEn=(e,t)=>{e.disabled=t},_send=(e,t)=>{Socket.send(e+t)};function copy(e){if(!e)return e;let t,n=Array.isArray(e)?[]:{};for(const s in e)t=e[s],n[s]="object"==typeof t?copy(t):t;return n}const toNum=e=>parseFloat(e.substring(0,e.lastIndexOf("px"))),validateCred=(e,t)=>!!e.match(/^[^!#;+\]\/"\t][^+\]"\t]{0,31}$/)&&!(""==t||!t.match(/^[ -~]{8,63}$/));function animate({timing:e,draw:t,duration:n}){let s=performance.now();requestAnimationFrame(function r(a){let d=(a-s)/n;d>1&&(d=1);let o=e(d);t(o),d<1&&requestAnimationFrame(r)})}const connect=()=>{Socket=new WebSocket("ws://"+window.location.hostname+":81/");var e=d("connection");Socket.onmessage=(e=>{er(e.data)}),Socket.onopen=(()=>{er("Socket connected."),e.innerHTML="Online <div class='dot dot-online'></div>"}),Socket.onclose=(t=>{er("Socket is closed. Reattempting.."),e.innerHTML="Retry <div class='dot dot-reconn'></div>",setTimeout(function(){connect()},250)}),Socket.onerror=(t=>{console.error("Socket encountered error: ",t.message,"Closing socket"),e.innerHTML="Offline <div class='dot dot-offline'></div>",Socket.close()})},navBarSlide=()=>{var e=dc("nav-bar"),t=1==state.navbar?0:1;state.navbar=t,animate({duration:1e3,timing:function(e){return val=1/(1+Math.exp(-(30*e-5)))},draw:function(n){var s=-100*Math.abs(t-n);Math.abs(s)>96?(dnone(e),state.navbar=0,updateAllHeights()):Math.abs(s)<5?(dflex(e),state.navbar=1,updateAllHeights()):(dflex(e),state.navbar=t),e.style.transform=`translateX(${s}%)`}})},closeNavBar=()=>{state.navbar&&navBarSlide()},showGamepad=()=>{var e=dc("settings"),t=dc("gamepad"),n=dc("setup");keyEvents(controllerState.keyboardS),joyEvents(controllerState.joystickS),dnone(e),dnone(n),dflex(t)},showSettings=()=>{dnone(dc("gamepad")),dnone(dc("setup")),dflex(dc("settings")),keyEvents(!1)},showSetup=()=>{keyEvents(!1),dnone(dc("gamepad")),dnone(dc("settings")),dflex(dc("setup"))};dae(dc("nav-hamburger"),"click",()=>{navBarSlide(),showGamepad()}),dae(dc("gamepad"),"click",()=>{closeNavBar(),showGamepad()}),dae(d("setup"),"click",()=>{closeNavBar(),keyEvents(!1),dnone(dc("gamepad")),dnone(dc("settings")),dflex(dc("setup"))}),dae(d("setting"),"click",()=>{closeNavBar(),dnone(dc("gamepad")),dnone(dc("setup")),dflex(dc("settings")),keyEvents(!1)}),dae(d("SUBMIT_STA"),"click",()=>{var e=d("SSID_STA").value,t=d("PASS_STA").value;validateCred(e,t)?fetch(`${HOST_URL}/cred`,{method:"POST",headers:{"Content-type":"application/x-www-form-urlencoded"},body:`type=STA&ssid=${e}&pass=${t}`}).then(e=>e.text()).then(e=>{d("SSID_STA").value="",d("PASS_STA").value=""}):(d("SSID_STA").value="",d("PASS_STA").value="",er("Enter Correct Creds"))}),dae(d("SUBMIT_AP"),"click",()=>{var e=d("SSID_AP").value,t=d("PASS_AP").value;validateCred(e,t)?fetch(`${HOST_URL}/cred`,{method:"POST",headers:{"Content-type":"application/x-www-form-urlencoded"},body:`type=AP&ssid=${e}&pass=${t}`}).then(e=>e.text()).then(e=>{d("SSID_AP").value="",d("PASS_AP").value=""}):(d("SSID_AP").value="",d("PASS_AP").value="",er("Enter Correct Creds"))});const showPass=(e,t)=>{let n=d(t);n.type="password"==n.type?"text":"password";let s=EYECLOSE.replace("{{e}}",`onclick="showPass(this,'${t}')"`),r=EYEOPEN.replace("{{e}}",`onclick="showPass(this,'${t}')"`),a="text"==n.type?r:s;e.parentElement.innerHTML=a},updateState=e=>{state={...state,...e},connect(),headLight(),brightness(),speed()},resetState=()=>{fetch(`${HOST_URL}/resetstate`).then(e=>e.text()).then(()=>{fetch(`${HOST_URL}/state`).then(e=>e.json()).then(e=>updateState(e))})};dae(d("reset-state"),"click",resetState);const resetCreds=()=>{fetch(`${HOST_URL}/resetcreds`).then(e=>e.text())};dae(d("reset-creds"),"click",resetCreds);const resetAll=()=>{resetState(),resetCreds()};dae(d("reset-all"),"click",resetAll);const updateAllHeights=()=>{const e=(e,t)=>{e.style.height=t};var t=getComputedStyle(dc("header")),n=getComputedStyle(dc("container")),s=toNum(n.height)-toNum(t.height)+"px";e(dc("nav-bar"),s),e(dc("gamepad"),s),e(dc("settings"),s),e(dc("setup"),s)};dae(window,"resize",updateAllHeights);const hlToggle=()=>{state.headLight=1-state.headLight,headLight(),sendCommand("s","h",state.headLight)},headLight=()=>{var e=d("headLight-icon");1==state.headLight?e.style.display="inline":e.style.display="none"},brightness=()=>{d("brightness").value=state.brightness,state.brightness=parseInt(d("brightness").value);var e=getComputedStyle(document.querySelector(":root")).getPropertyValue("--headLight-glow");d("headLight-icon").style.filter=`drop-shadow(0 0 ${4*state.brightness/100}px ${e})`},changeBrightness=e=>{sendCommand("s","b",e)},speed=()=>{dc("speed").value=state.speed,state.speed=parseInt(dc("speed").value),d("speed-val").innerHTML=state.speed},changeSpeed=e=>{sendCommand("s","s",e)};dae(d("brightness"),"input",e=>{state.brightness=e.target.value,brightness()}),dae(dc("speed"),"input",e=>{state.speed=e.target.value,speed()});const getTheme=()=>localStorage.getItem("theme"),setTheme=e=>{localStorage.setItem("theme",e),document.documentElement.className=e,d("darkmode").innerHTML="darkMode"==e?"Light Mode":"Dark Mode"},toggleTheme=()=>setTheme("darkMode"!=getTheme()?"darkMode":"lightMode");dae(d("darkmode"),"click",toggleTheme);const sendCommand=(e,t,n)=>{_send(e[0]+t,n)},forwardO=()=>sendCommand("c",0,1),reverseO=()=>sendCommand("c",1,1),leftO=()=>sendCommand("c",2,1),rightO=()=>sendCommand("c",3,1),forwardF=()=>sendCommand("c",0,0),reverseF=()=>sendCommand("c",1,0),leftF=()=>sendCommand("c",2,0),rightF=()=>sendCommand("c",3,0),stop=()=>sendCommand("o","s",0);btnEvents=[{t:"forward",o:forwardO,f:forwardF},{t:"right",o:rightO,f:rightF},{t:"backward",o:reverseO,f:reverseF},{t:"left",o:leftO,f:leftF}];const validDs=e=>{e.value=e.value.replaceAll(/[+-.]/g,""),"MM"!=e.placeholder&&"SS"!=e.placeholder||parseInt(e.value)>59&&(e.value=59)},getDSTime=()=>{let e=d("dsHH"),t=d("dsMM"),n=d("dsSS"),s=0;return s=""===e.value?0:3600*parseInt(e.value),s+=""===t.value?0:60*parseInt(t.value),s=0===(s+=""===n.value?0:parseInt(n.value))?1:s,e.value="",t.value="",n.value="",s};dae(d("timed-ds"),"click",()=>{sendCommand("s","d",getDSTime())}),dae(document,"DOMContentLoaded",()=>{updateAllHeights(),btnEvents.forEach(e=>{dae(dc(e.t),"mousedown",e.o),dae(dc(e.t),"mouseup",e.f),dae(dc(e.t),"touchStart",e.o),dae(dc(e.t),"touchend",e.f)}),dae(dc("speed"),"keydown",e=>{e.preventDefault()}),dae(dc("stop"),"click",()=>{stop(),fetch(`${HOST_URL}/off`)}),keyInit(),joyInit(),dae(window,"gamepadconnected",()=>{er("gamepad connected"),state.jConn=!0,joyEvents(controllerState.joystickS),createGVector()}),dae(window,"gamepaddisconnected",()=>{state.jConn=!1,joyEvents(controllerState.joystickS),clearProgress()}),fetch(`${HOST_URL}/state`).then(e=>{if(e.ok)return e.json();throw new Error("Please reset status...")}).then(e=>{updateState(e),dae(d("headlight"),"click",hlToggle),dae(d("brightness"),"change",e=>{changeBrightness(e.target.value)}),dae(dc("speed"),"change",e=>{changeSpeed(e.target.value)}),dae(d("restart"),"click",()=>sendCommand("s","r",0)),dae(d("deepSleep"),"click",()=>sendCommand("s","d",0))}).catch(e=>er(e))});const saveTable=(e,t)=>{localStorage.setItem(e,JSON.stringify(t))},getTable=e=>JSON.parse(localStorage.getItem(e)),loadTable=(e,t)=>{let n=copy(e),s=getTable(t);if(s)for(var r=0;r<n.length;r++)n[r].key=s[r].key;else saveTable(t,e);return n},handleController=e=>{let t=e.target.checked;for(var n in controllerState){controllerState[n]=!1;try{d(n).checked=!1}catch(e){}}d(e.target.id).checked=t,controllerState[e.target.id]=t,joyEvents(controllerState.joystickS)},kConDefault=[{type:"forward",command:"forward",key:"ArrowUp",KEYDOWN:forwardO,KEYUP:forwardF},{type:"reverse",command:"reverse",key:"ArrowDown",KEYDOWN:reverseO,KEYUP:reverseF},{type:"right",command:"right",key:"ArrowRight",KEYDOWN:rightO,KEYUP:rightF},{type:"left",command:"left",key:"ArrowLeft",KEYDOWN:leftO,KEYUP:leftF},{type:"stop",command:"Stop",key:"Space",KEYDOWN:stop},{type:"light",command:"Headlight",key:"KeyB",KEYDOWN:()=>{keyBrightness("press")}},{type:"brightnessp",command:"Headlight Brightness +",key:"KeyH",KEYDOWN:()=>{keyBrightness("plus")}},{type:"brightnessm",command:"Headlight Brightness -",key:"KeyN",KEYDOWN:()=>{keyBrightness("minus")}},{type:"speedp",command:"Speed +",key:"NumpadAdd",KEYDOWN:()=>{keySpeed("plus")}},{type:"speedm",command:"Speed -",key:"NumpadSubtract",KEYDOWN:()=>{keySpeed("minus")}}];var kCont;const keySpeed=e=>{switch(e){case"plus":state.speed<255&&(state.speed+=10,speed(),changeSpeed(state.speed));break;case"minus":state.speed>0&&(state.speed-=10,speed(),changeSpeed(state.speed))}},keyBrightness=e=>{switch(e){case"press":hlToggle();break;case"plus":state.brightness<255&&(state.brightness+=10,brightness(),changeBrightness(state.brightness));break;case"minus":state.brightness>0&&(state.brightness-=10,brightness(),changeBrightness(state.brightness))}},keyControl=e=>{kCont.forEach(t=>{t.key==e.code&&t[e.type.toUpperCase()]()})},getkeyObj=e=>{for(var t,n=0;n<kCont.length;n++)kCont[n].type==e&&(t=kCont[n]);return t},keyEvents=e=>{e?(dae(document,"keydown",keyControl),dae(document,"keyup",keyControl)):(dar(document,"keydown",keyControl),dar(document,"keyup",keyControl))},renderKeys=()=>{const e=d("keyboard-controls");let t='<tr class="table-head"><th>Control</th><th>Key</th></tr>';kCont.forEach(e=>{t+=`<tr class="table-body" id="${e.type}p"><td>${e.command}</td><td id="${e.type}" onclick="editKeyTable(this)">${e.key}</td></tr>`}),e.innerHTML=t},editKeyTable=e=>{e.parentElement.innerHTML=`<td>${getkeyObj(e.id).command}</td><td id="${e.id}"><input type='text' class='table-text' onkeydown="setKey(event, this.parentElement.id)" placeholder="press a key"></td>`,d(e.id).childNodes[0].focus()};function validateKeyPress(e){return e>47&&e<58||32==e||13==e||e>36&&e<41||e>64&&e<91||e>95&&e<112||e>185&&e<193||e>218&&e<223}function keyNotExists(e){let t=!0;return kCont.forEach(n=>{n.key==e&&(t=!1)}),t}const setKey=(e,t)=>{if((e=e||window.event).preventDefault(),validateKeyPress(e.charCode?e.charCode:e.keyCode)&&keyNotExists(e.code)){for(var n=0;n<kCont.length;n++)kCont[n].type==t&&(kCont[n].key=e.code);saveTable("keyControl",kCont),d(t+"p").innerHTML=`<td>${t}</td><td id='${t}' onclick='editKeyTable(this)'>${e.code}</td>`}else renderKeys()},resetKeys=()=>{saveTable("keyControl",kConDefault),kCont=copy(kConDefault),renderKeys()};dae(d("key-reset"),"click",resetKeys);const keyInit=()=>{kCont=loadTable(kConDefault,"keyControl"),renderKeys()},joyDefault=[{type:"forward",command:"Forward/Reverse",key:"a1",sent:{forwardO:!1,reverseO:!1}},{type:"right",command:"Left/Right",key:"a0",sent:{leftO:!1,rightO:!1}},{type:"stop",command:"Stop",key:"b2",KEYDOWN:stop},{type:"light",command:"Headlight",key:"b0",KEYDOWN:()=>{keyBrightness("press")}},{type:"brightnessp",command:"Headlight Brightness +",key:"b5",KEYDOWN:()=>{keyBrightness("plus")}},{type:"brightnessm",command:"Headlight Brightness -",key:"b7",KEYDOWN:()=>{keyBrightness("minus")}},{type:"speedp",command:"Speed +",key:"b4",KEYDOWN:()=>{keySpeed("plus")}},{type:"speedm",command:"Speed -",key:"b6",KEYDOWN:()=>{keySpeed("minus")}}];var joyCon,gVector=[];const getGObj=e=>{for(var t,n=0;n<gVector.length;n++)gVector[n].index==e&&(t=gVector[n]);return t},joyEvents=e=>{e?state.jConn&&update():(cancelAnimationFrame(joyUpdate),clearProgress())},renderJoy=()=>{const e=d("joystick-controls");let t='<tr class="table-head"><th>Control</th><th>Channel</th></tr>';joyCon.forEach(e=>{t+=`<tr class="table-body" id="${e.type}j"><td>${e.command}</td><td id="${e.type}"><div class="progress" id="p${e.key}"><div><div></div></div></td></tr>`}),e.innerHTML=t},clearProgress=()=>{joyCon.forEach(e=>{d(`p${e.key}`).childNodes[0].childNodes[0].style.width="0%"})},clearSent=e=>{for(var t in e)e[t]=!1},joyLogic=()=>{joyCon.forEach(e=>{var t=getGObj(e.key);"flex"==dc("settings").style.display&&(d(`p${e.key}`).childNodes[0].childNodes[0].style.width=`${100*t.curr}%`);try{if("axis"==t.type)switch(e.command){case"Forward/Reverse":t.curr>.7?e.sent.reverseO||(clearSent(e.sent),e.sent.reverseO=!0,reverseO()):t.curr<.3?e.sent.forwardO||(clearSent(e.sent),e.sent.forwardO=!0,forwardO()):e.sent.forwardO?(clearSent(e.sent),forwardF()):e.sent.reverseO&&(clearSent(e.sent),reverseF());break;case"Left/Right":t.curr>.7?e.sent.rightO||(clearSent(e.sent),e.sent.rightO=!0,rightO()):t.curr<.3?e.sent.leftO||(clearSent(e.sent),e.sent.leftO=!0,leftO()):e.sent.leftO?(clearSent(e.sent),leftF()):e.sent.rightO&&(clearSent(e.sent),rightF())}else t.curr-t.prev==1&&e.KEYDOWN()}catch(e){}})};var joyUpdate;const update=()=>{for(const t of navigator.getGamepads()){var e=0;if(t){for(const[n,s]of t.axes.entries())gVector[e].prev=gVector[e].curr,gVector[e].curr=.5*s+.5,e++;for(const[n,s]of t.buttons.entries())gVector[e].prev=gVector[e].curr,gVector[e].curr=s.value,e++;joyCon.forEach(e=>{var t=getGObj(e.key);"flex"==dc("settings").style.display&&(d(`p${e.key}`).childNodes[0].childNodes[0].style.width=`${100*t.curr}%`);try{if("axis"==t.type)switch(e.command){case"Forward/Reverse":t.curr>.7?e.sent.reverseO||(clearSent(e.sent),e.sent.reverseO=!0,reverseO()):t.curr<.3?e.sent.forwardO||(clearSent(e.sent),e.sent.forwardO=!0,forwardO()):e.sent.forwardO?(clearSent(e.sent),forwardF()):e.sent.reverseO&&(clearSent(e.sent),reverseF());break;case"Left/Right":t.curr>.7?e.sent.rightO||(clearSent(e.sent),e.sent.rightO=!0,rightO()):t.curr<.3?e.sent.leftO||(clearSent(e.sent),e.sent.leftO=!0,leftO()):e.sent.leftO?(clearSent(e.sent),leftF()):e.sent.rightO&&(clearSent(e.sent),rightF())}else t.curr-t.prev==1&&e.KEYDOWN()}catch(e){}});break}}joyUpdate=requestAnimationFrame(update)},createGVector=()=>{gVector=[];for(const n of navigator.getGamepads())if(n){for(const[t,s]of n.axes.entries()){var e={type:"axis",index:`a${t}`,prev:s,curr:s};gVector.push(e)}for(const[e,s]of n.buttons.entries()){var t={type:"button",index:`b${e}`,prev:s.value,curr:s.value};gVector.push(t)}break}},joyInit=()=>{joyCon=loadTable(joyDefault,"joyControl"),renderJoy()};toggleTheme(),toggleTheme(),function(){var e=0;btnEvents.forEach(t=>{dc(t.t).innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke-linecap="round"\n                stroke-linejoin="round">\n                <line x1="12" y1="19" x2="12" y2="5"></line>\n                <polyline points="5 12 12 5 19 12"></polyline>\n                </svg>',dc(t.t).childNodes[0].style=`transform:rotate(${90*e++}deg)`});let t=dca("pass");for(var n=0;n<t.length;n++){let e=t[n].id.substring(1);t[n].innerHTML+=EYECLOSE.replace("{{e}}",`onclick="showPass(this,'${e}')"`)}}();
)=====";